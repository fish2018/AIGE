import{d as Re,u as Ie,r as v,p as Q,q as Le,s as He,c as o,h as A,m as t,F as X,v as Y,t as p,l as me,x as Z,y as ke,z as $e,A as we,B as je,n as y,e as Pe,C as x,o as r}from"./index-BQeSgM5s.js";import{k as ze}from"./marked.esm-z4go5P_g.js";import{_ as Je}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ke={class:"game-container"},Ue={key:0,class:"game-selection"},qe={class:"game-list"},Fe=["onClick"],Qe={class:"game-card-footer"},Xe={class:"version"},Ye={class:"author"},Ze={key:1,class:"game-play"},De={class:"game-header"},es={class:"header-top"},ss={class:"game-title"},ts={class:"mod-id"},is={class:"pc-actions"},as={class:"opportunities"},ns=["disabled"],ls={class:"mobile-actions"},os={class:"opportunities mobile-opportunities-inline"},rs=["disabled"],cs={class:"game-content"},ds={class:"status-panel pc-status-panel"},us={class:"panel-content"},vs={key:0,class:"character-status"},ps={class:"status-key"},fs=["innerHTML"],ys={key:1,class:"no-character"},_s={class:"game-main"},hs=["innerHTML"],gs={class:"pc-input-area"},bs=["disabled"],ms={key:1,class:"action-input-row"},ks=["disabled"],$s=["disabled"],ws={key:2,class:"success-message"},js={class:"mobile-input-area"},Ss={class:"input-area"},As=["disabled"],Cs={key:1,class:"action-input-row"},Os=["disabled"],xs=["disabled"],Ms={key:2,class:"success-message"},Ts={class:"status-panel-content"},Vs={key:0,class:"character-status"},Gs={class:"status-key"},Ns=["innerHTML"],Ws={key:1,class:"no-character"},Bs={key:2,class:"roll-overlay"},Es={class:"roll-panel"},Rs={class:"roll-details"},Is={class:"roll-type"},Ls={key:0,class:"roll-target"},Hs={key:0,class:"roll-result-display"},Ps={class:"roll-value"},zs={key:3,class:"loading-overlay"},Js={class:"loading-spinner"},Ks={class:"loading-text"},Us=Re({__name:"GameView",setup(qs){const te=Pe(),k=Ie(),D=v([]),_=v(""),ie=v(null),n=v(null),Se=Q(()=>{var e;return((e=n.value)==null?void 0:e.display_history)||[]}),f=Q(()=>{var e;return((e=n.value)==null?void 0:e.state)||n.value||{}}),H=Q(()=>{var i;const e=(i=f.value)==null?void 0:i.current_life;if(!e||typeof e!="object")return null;const s={};for(const[a,l]of Object.entries(e))if(l!=null&&l!==""&&l!==0){if(Array.isArray(l)&&l.length===0||typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;s[a]=l}return Object.keys(s).length>0?s:null}),$=v(""),M=v(!1),P=v(!1),j=Q(()=>{var e;return((e=f.value)==null?void 0:e.is_processing)||!1}),g=v(!1),T=v("加载中..."),ee=v(!1),h=v(null),b=v(!1),V=v(!1);let d=null;const w=v(!1),G=v(!0),z=v();async function ae(){try{g.value=!0;const e=await fetch("/api/game/mods",{headers:{Authorization:`Bearer ${k.token}`}});e.ok?D.value=await e.json():y.error("加载游戏列表失败")}catch(e){console.error("加载mod列表失败:",e),y.error("网络错误")}finally{g.value=!1}}async function Ae(e){G.value=!0,_.value=e,ie.value=D.value.find(s=>s.game_id===e),await Ce()}async function Ce(){try{g.value=!0,T.value="正在初始化游戏...";const e=await fetch("/api/game/init",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.token}`},body:JSON.stringify({mod_id:_.value})});if(e.ok){T.value="正在加载游戏数据...";const s=await e.json();n.value=s.state||s,T.value="正在建立实时连接...",ne()}else{const s=await e.text();console.error("[GameView] 初始化失败:",s),y.error("初始化游戏失败: "+s)}}catch(e){console.error("初始化游戏失败:",e),y.error("网络错误")}finally{g.value=!1}}function ne(){const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/game/ws?mod_id=${_.value}&token=${k.token}`;d=new WebSocket(s),d.onopen=()=>{w.value=!0,g.value=!1,y.success("连接成功")},d.onmessage=i=>{try{const a=JSON.parse(i.data);Oe(a)}catch(a){console.error("[GameView] 解析WebSocket消息失败:",a)}},d.onerror=i=>{console.error("[GameView] ❌ WebSocket错误:",i),w.value=!1,y.error("连接错误")},d.onclose=i=>{w.value=!1,G.value&&_.value&&k.token&&setTimeout(()=>{ne()},3e3)}}const N=v(""),J=v(!1),C=v(null),W=v(""),K=v(!1);function Oe(e){var s;switch(g.value=!1,e.type){case"narrative_chunk":J.value||(J.value=!0,N.value="",n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,N.value])),N.value+=e.data.content;let i=N.value;const a=i.indexOf("```json");a>=0&&(i=i.substring(0,a).trim());const l=i.indexOf("```");l>=0&&(i=i.substring(0,l).trim());const c=i.match(/【判定结果：(成功|失败)】/);if(c&&!C.value){C.value=i,le(c[1]==="成功");return}if(n.value&&n.value.display_history){const B=n.value.display_history.length-1;n.value.display_history=[...n.value.display_history.slice(0,B),i]}x(()=>O());break;case"full_state":J.value=!1,K.value=!1,b.value=!1;const F=((s=n.value)==null?void 0:s.display_history)||[];n.value={...e.data,display_history:F},N.value="",W.value="",C.value=null,x(()=>O());break;case"roll_event":b.value=!0,le(e.data.success,e.data);break;case"roll_result":n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,e.data.content],x(()=>O()));break;case"second_stage_narrative":K.value||(K.value=!0,W.value="",n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,W.value])),W.value+=e.data.content;let m=W.value;const I=m.indexOf("```json");I>=0&&(m=m.substring(0,I).trim());const L=m.indexOf("```");if(L>=0&&(m=m.substring(0,L).trim()),n.value&&n.value.display_history){const B=n.value.display_history.length-1;n.value.display_history=[...n.value.display_history.slice(0,B),m],x(()=>O())}break;case"error":J.value=!1,K.value=!1,N.value="",W.value="",C.value=null,y.error(e.detail||"发生错误");break}}function le(e,s){ee.value=!0,s?h.value={type:s.type||"天道裁决",target:s.target,description:s.description||"判定中...",result:s.result,success:e,outcome:s.outcome}:h.value={description:"判定中...",success:e},setTimeout(()=>{h.value&&(h.value.description=(s==null?void 0:s.description)||(e?"判定成功！":"判定失败！"))},1500),setTimeout(()=>{if(ee.value=!1,h.value=null,C.value&&n.value){const i=n.value.display_history.length-1;n.value.display_history=[...n.value.display_history.slice(0,i),C.value],x(()=>O())}C.value=null},3e3)}async function oe(){if(!d||d.readyState!==WebSocket.OPEN){console.error("[GameView] WebSocket未连接"),y.error("连接未就绪，请稍候重试");return}n.value&&n.value.state&&(n.value.state.is_processing=!0),n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,"> 开始试炼"],x(()=>O())),g.value=!0,T.value="正在开启试炼...",d.send(JSON.stringify({action:"start_trial"}))}function U(){if($.value.trim()&&d&&d.readyState===WebSocket.OPEN){const e=$.value.trim();n.value&&n.value.state&&(n.value.state.is_processing=!0),n.value&&n.value.display_history&&(n.value.display_history=[...n.value.display_history,`> ${e}`],x(()=>O())),d.send(JSON.stringify({action:e})),$.value=""}}async function se(){if(_.value){V.value=!0;try{const e=await fetch("/api/game/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.token}`},body:JSON.stringify({mod_id:_.value})});if(e.ok)y.success("存档成功");else{const s=await e.text();console.error("[GameView] 存档失败:",s),y.error("存档失败")}}catch(e){console.error("[GameView] 存档异常:",e),y.error("存档异常")}finally{V.value=!1}}}function re(){confirm(`⚠️ 确定要重启机缘吗？

这将会：
• 清空当前游戏的存档数据
• 重置机缘次数为10次
• 无法恢复已删除的数据

确认继续？`)&&xe()}async function xe(){var e;try{g.value=!0,T.value="正在重启机缘...";const s=await fetch("/api/game/restart-opportunities",{method:"POST",headers:{Authorization:`Bearer ${k.token}`,"Content-Type":"application/json"},body:JSON.stringify({mod_id:_.value})});if(s.ok){const i=await s.json();G.value=!1,d&&(d.close(),d=null),w.value=!1,_.value="",n.value=null,await ae(),y.success(`机缘已重启！删除了 ${i.deleted_saves} 条存档`)}else{const i=await s.text();console.error("[GameView] 重启机缘失败 - 状态码:",s.status),console.error("[GameView] 重启机缘失败 - 响应:",i),console.error("[GameView] 重启机缘失败 - token长度:",((e=k.token)==null?void 0:e.length)||0),s.status===401?(y.error("认证失败，请重新登录"),k.logout(),te.push("/login")):y.error("重启机缘失败: "+i)}}catch(s){console.error("重启机缘失败:",s),y.error("网络错误")}finally{g.value=!1}}function Me(){M.value=!M.value}function ce(){M.value=!1}function Te(){P.value=!P.value}function E(){P.value=!1}async function Ve(){G.value=!1,_.value&&await se(),d&&(d.close(),d=null),w.value=!1,_.value="",n.value=null}async function Ge(){G.value=!1,_.value&&await se(),d&&(d.close(),d=null),k.logout(),te.push("/login")}function Ne(e){try{let s=e.replace(/\\n/g,`
`);return ze.parse(s,{breaks:!0,gfm:!0})}catch{return e.replace(/\\n/g,"<br>").replace(/\n/g,"<br>")}}function We(e){return e.startsWith("> ")?"user-message":e.startsWith("【判定结果：")?"roll-result-message":e.startsWith("【")?"system-message":"narrative-message"}function R(e){const s=[{pattern:/^(姓名|名称|角色)$/i,icon:"🧙‍♂️"},{pattern:/^(修为|经验|exp)$/i,icon:"⚡"},{pattern:/^(境界|等级|level|阶位)$/i,icon:"🏔️"},{pattern:/^(生命|血量|hp|health)$/i,icon:"❤️"},{pattern:/^(寿元|寿命|年龄|age)$/i,icon:"⏳"},{pattern:/^(灵石|金币|货币|money|gold)$/i,icon:"💎"},{pattern:/^(位置|地点|location)$/i,icon:"📍"},{pattern:/^(出身|背景|origin)$/i,icon:"🏡"},{pattern:/^(天赋|才能|talent)$/i,icon:"⭐"},{pattern:/^(灵根|资质|根骨)$/i,icon:"🌿"},{pattern:/^(属性|状态|stats)$/i,icon:"📊"},{pattern:/^(功法|技能|skill)$/i,icon:"📚"},{pattern:/^(物品|道具|背包|inventory)$/i,icon:"🎒"},{pattern:/^(状态|效果|buff|debuff)$/i,icon:"💫"},{pattern:/^(事件|历史|故事|history)$/i,icon:"📜"},{pattern:/^(目标|任务|quest)$/i,icon:"🎯"},{pattern:/^(关系|人际|社交)$/i,icon:"👥"},{pattern:/^(药园|农场|种植)$/i,icon:"🌱"},{pattern:/^(悟性|智力|intelligence)$/i,icon:"🧠"},{pattern:/^(气运|运气|luck)$/i,icon:"🍀"},{pattern:/^(声望|名望|reputation)$/i,icon:"⭐"}];for(const i of s)if(i.pattern.test(e))return`${i.icon} ${e}`;return`📋 ${e}`}function q(e){if(e==null)return'<span class="empty-value">无</span>';if(typeof e=="string")return e;if(typeof e=="number")return e.toString();if(Array.isArray(e))return e.length===0?'<span class="empty-value">无</span>':e.map(s=>typeof s=="string"?`<div class="array-item">• ${s}</div>`:typeof s=="object"&&s!==null?s.名称&&s.数量?`<div class="item-entry">• ${s.名称} × ${s.数量}${s.说明?`<br><span class="item-desc">${s.说明}</span>`:""}</div>`:`<div class="array-item">• ${ue(s)}</div>`:`<div class="array-item">• ${s}</div>`).join("");if(typeof e=="object"){if(e.人生目标||e.立即目标||e.阶段目标){let s='<div class="goal-system-container">';return e.人生目标&&(s+='<div class="goal-section goal-life">',s+='<div class="goal-section-title">🌟 人生目标</div>',s+='<div class="goal-section-content">',e.人生目标.描述&&(s+=`<div class="goal-field"><span class="field-label">描述：</span>${e.人生目标.描述}</div>`),e.人生目标.核心动机&&(s+=`<div class="goal-field"><span class="field-label">核心动机：</span>${e.人生目标.核心动机}</div>`),e.人生目标.最终愿景&&(s+=`<div class="goal-field"><span class="field-label">最终愿景：</span>${e.人生目标.最终愿景}</div>`),e.人生目标.宿命纠葛&&Array.isArray(e.人生目标.宿命纠葛)&&e.人生目标.宿命纠葛.length>0&&(s+=`<div class="goal-field"><span class="field-label">宿命纠葛：</span><div class="field-list">${e.人生目标.宿命纠葛.map(i=>`<div class="list-item">• ${i}</div>`).join("")}</div></div>`),s+="</div></div>"),e.立即目标&&(s+='<div class="goal-section goal-immediate">',s+='<div class="goal-section-title">⚡ 立即目标</div>',s+='<div class="goal-section-content">',e.立即目标.描述&&(s+=`<div class="goal-field"><span class="field-label">描述：</span>${e.立即目标.描述}</div>`),e.立即目标.紧迫程度&&(s+=`<div class="goal-field"><span class="field-label">紧迫程度：</span><span class="urgency-badge urgency-${e.立即目标.紧迫程度}">${e.立即目标.紧迫程度}</span></div>`),e.立即目标.完成条件&&(s+=`<div class="goal-field"><span class="field-label">完成条件：</span>${e.立即目标.完成条件}</div>`),e.立即目标.奖励预期&&(s+=`<div class="goal-field"><span class="field-label">奖励预期：</span>${e.立即目标.奖励预期}</div>`),s+="</div></div>"),e.阶段目标&&(s+='<div class="goal-section goal-stage">',s+='<div class="goal-section-title">📈 阶段目标</div>',s+='<div class="goal-section-content">',e.阶段目标.描述&&(s+=`<div class="goal-field"><span class="field-label">描述：</span>${e.阶段目标.描述}</div>`),e.阶段目标.关键节点&&Array.isArray(e.阶段目标.关键节点)&&e.阶段目标.关键节点.length>0&&(s+=`<div class="goal-field"><span class="field-label">关键节点：</span><div class="field-list">${e.阶段目标.关键节点.map(i=>`<div class="list-item">• ${i}</div>`).join("")}</div></div>`),e.阶段目标.障碍分析&&(s+=`<div class="goal-field"><span class="field-label">障碍分析：</span>${e.阶段目标.障碍分析}</div>`),e.阶段目标.解决路径&&(s+=`<div class="goal-field"><span class="field-label">解决路径：</span>${e.阶段目标.解决路径}</div>`),s+="</div></div>"),s+="</div>",s}return e.姓名||e.境界||e.修为||e.灵根?Be(e):de(e)}return String(e)}function Be(e){let s='<div class="attributes-expanded">';const i=["姓名","出身","灵根","境界","寿元","生命值","修为","灵石","根骨","悟性","气运","初始天赋","功法","神通","物品","状态效果","关系网","声望","特殊标记","灵兽","道侣","洞府","药园"];return i.forEach(a=>{e[a]!==void 0&&e[a]!==null&&e[a]!==""&&!(Array.isArray(e[a])&&e[a].length===0)&&!(typeof e[a]=="object"&&!Array.isArray(e[a])&&Object.keys(e[a]).length===0)&&(s+=`<div class="attr-sub-item">
        <div class="attr-sub-key">${R(a)}</div>
        <div class="attr-sub-value">${q(e[a])}</div>
      </div>`)}),Object.keys(e).forEach(a=>{!i.includes(a)&&e[a]!==void 0&&e[a]!==null&&e[a]!==""&&!(Array.isArray(e[a])&&e[a].length===0)&&!(typeof e[a]=="object"&&!Array.isArray(e[a])&&Object.keys(e[a]).length===0)&&(s+=`<div class="attr-sub-item">
        <div class="attr-sub-key">${R(a)}</div>
        <div class="attr-sub-value">${q(e[a])}</div>
      </div>`)}),s+="</div>",s}function de(e,s=0){const i=Object.entries(e).filter(([l,c])=>!(c==null||c===""||Array.isArray(c)&&c.length===0||typeof c=="object"&&!Array.isArray(c)&&Object.keys(c).length===0));if(i.length===0)return'<span class="empty-value">无</span>';let a='<div class="object-expanded">';return i.forEach(([l,c])=>{a+='<div class="object-item">',a+=`<div class="object-key">${R(l)}</div>`,a+='<div class="object-value">',c==null?a+='<span class="empty-value">无</span>':typeof c=="string"||typeof c=="number"||typeof c=="boolean"?a+=String(c):Array.isArray(c)?a+=Ee(c,s+1):typeof c=="object"?a+=de(c,s+1):a+=String(c),a+="</div>",a+="</div>"}),a+="</div>",a}function Ee(e,s=0){if(e.length===0)return'<span class="empty-value">无</span>';let i='<div class="array-container">';return e.forEach(a=>{i+='<div class="array-item-wrapper">',typeof a=="string"||typeof a=="number"||typeof a=="boolean"?i+=`<div class="array-item-simple">• ${a}</div>`:typeof a=="object"&&a!==null?(i+='<div class="array-item-object">',i+=ue(a),i+="</div>"):i+=`<div class="array-item-simple">• ${a}</div>`,i+="</div>"}),i+="</div>",i}function ue(e){const s=Object.entries(e);if(s.length===0)return'<span class="empty-value">无</span>';let i='<div class="inline-object">';return s.forEach(([a,l])=>{l==null||l===""||(i+='<div class="inline-item">',i+=`<span class="inline-key">${a}:</span> `,typeof l=="string"||typeof l=="number"||typeof l=="boolean"?i+=`<span class="inline-value">${l}</span>`:Array.isArray(l)?i+=`<span class="inline-value">[${l.length}项]</span>`:typeof l=="object"?i+='<span class="inline-value">{对象}</span>':i+=`<span class="inline-value">${l}</span>`,i+="</div>")}),i+="</div>",i}function ve(){var s;if(!w.value)return"连接中...";const e=((s=f.value)==null?void 0:s.opportunities_remaining)??10;return e<=0?"机缘已尽":e===10?"开始第一次试炼":"开启下一次试炼"}function O(){z.value&&(z.value.scrollTop=z.value.scrollHeight)}return Le(()=>{ae()}),He(()=>{G.value=!1,d&&(d.close(),d=null),w.value=!1}),(e,s)=>{var i,a,l,c,F,m,I,L,B,pe,fe,ye,_e,he,ge,be;return r(),o("div",Ke,[_.value?(r(),o("div",Ze,[t("header",De,[t("div",es,[t("div",ss,[t("h2",null,p((i=ie.value)==null?void 0:i.name),1),t("span",ts,p(_.value),1)]),t("div",is,[t("span",as,[s[10]||(s[10]=me(" 剩余机缘: ",-1)),t("strong",null,p(((a=f.value)==null?void 0:a.opportunities_remaining)??10),1)]),t("button",{onClick:se,class:"btn-save",disabled:V.value},p(V.value?"存档中...":"💾 手动存档"),9,ns),t("button",{onClick:re,class:"btn-restart",title:"清空所有存档，重新开始"}," 🔄 重启机缘 "),t("button",{onClick:Ve,class:"btn-secondary"},"切换游戏"),t("button",{onClick:Ge,class:"btn-danger"},"退出")]),t("div",ls,[t("span",os,[s[11]||(s[11]=me(" 剩余机缘: ",-1)),t("strong",null,p(((l=f.value)==null?void 0:l.opportunities_remaining)??10),1)]),t("button",{onClick:Me,class:Z(["btn-status",{active:M.value}])}," 状态 ",2),t("button",{onClick:Te,class:"btn-menu"}," ⚙️ ")])])]),P.value?(r(),o("div",{key:0,class:"mobile-menu-overlay",onClick:E},[t("div",{class:"mobile-menu",onClick:s[4]||(s[4]=ke(()=>{},["stop"]))},[t("button",{onClick:s[0]||(s[0]=u=>{E()}),disabled:V.value},p(V.value?"存档中...":"💾 手动存档"),9,rs),t("button",{onClick:s[1]||(s[1]=u=>{re(),E()})}," 🔄 重启机缘 "),t("button",{onClick:s[2]||(s[2]=u=>{E()})}," 🎮 切换游戏 "),t("button",{onClick:s[3]||(s[3]=u=>{E()})}," 🚪 退出 ")])])):A("",!0),t("div",cs,[t("aside",ds,[s[13]||(s[13]=t("div",{class:"panel-header"},[t("h3",null,"角色状态")],-1)),t("div",us,[H.value?(r(),o("div",vs,[(r(!0),o(X,null,Y(H.value,(u,S)=>(r(),o("div",{key:S,class:"status-item"},[t("div",ps,p(R(S)),1),t("div",{class:"status-value",innerHTML:q(u)},null,8,fs)]))),128))])):(r(),o("div",ys,[...s[12]||(s[12]=[t("p",null,"尚未开始冒险",-1)])]))])]),t("main",_s,[t("div",{class:"narrative-window",ref_key:"narrativeWindow",ref:z},[(r(!0),o(X,null,Y(Se.value,(u,S)=>(r(),o("div",{key:S,class:Z(["narrative-block",We(u)]),innerHTML:Ne(u)},null,10,hs))),128))],512),t("div",gs,[!((c=f.value)!=null&&c.is_in_trial)&&!((F=f.value)!=null&&F.daily_success_achieved)?(r(),o("button",{key:0,onClick:oe,disabled:!w.value||j.value||b.value||(((m=f.value)==null?void 0:m.opportunities_remaining)??0)<=0,class:"btn-start"},p(ve()),9,bs)):(I=f.value)!=null&&I.is_in_trial?(r(),o("div",ms,[$e(t("input",{"onUpdate:modelValue":s[5]||(s[5]=u=>$.value=u),type:"text",placeholder:"汝欲何为...",onKeydown:je(U,["enter"]),disabled:j.value||b.value,class:"action-input"},null,40,ks),[[we,$.value]]),t("button",{onClick:U,disabled:j.value||b.value||!$.value.trim(),class:"btn-primary"},p(j.value?"处理中...":b.value?"判定中...":"行动"),9,$s)])):(L=f.value)!=null&&L.daily_success_achieved?(r(),o("div",ws,[...s[14]||(s[14]=[t("p",null,"🎉 今日功德圆满！明日再来。",-1)])])):A("",!0)])])]),t("div",js,[t("div",Ss,[!((B=f.value)!=null&&B.is_in_trial)&&!((pe=f.value)!=null&&pe.daily_success_achieved)?(r(),o("button",{key:0,onClick:oe,disabled:!w.value||j.value||b.value||(((fe=f.value)==null?void 0:fe.opportunities_remaining)??0)<=0,class:"btn-start"},p(ve()),9,As)):(ye=f.value)!=null&&ye.is_in_trial?(r(),o("div",Cs,[$e(t("input",{"onUpdate:modelValue":s[6]||(s[6]=u=>$.value=u),type:"text",placeholder:"汝欲何为...",onKeydown:je(U,["enter"]),disabled:j.value||b.value,class:"action-input"},null,40,Os),[[we,$.value]]),t("button",{onClick:U,disabled:j.value||b.value||!$.value.trim(),class:"btn-primary"},p(j.value?"处理中...":b.value?"判定中...":"行动"),9,xs)])):(_e=f.value)!=null&&_e.daily_success_achieved?(r(),o("div",Ms,[...s[15]||(s[15]=[t("p",null,"🎉 今日功德圆满！明日再来。",-1)])])):A("",!0)])]),M.value?(r(),o("div",{key:1,class:"mobile-status-overlay",onClick:ce},[t("div",{class:Z(["mobile-status-panel",{show:M.value}]),onClick:s[7]||(s[7]=ke(()=>{},["stop"]))},[t("div",{class:"status-panel-header"},[s[16]||(s[16]=t("h3",null,"角色状态",-1)),t("button",{onClick:ce,class:"close-btn"},"✕")]),t("div",Ts,[H.value?(r(),o("div",Vs,[(r(!0),o(X,null,Y(H.value,(u,S)=>(r(),o("div",{key:S,class:"status-item"},[t("div",Gs,p(R(S)),1),t("div",{class:"status-value",innerHTML:q(u)},null,8,Ns)]))),128))])):(r(),o("div",Ws,[...s[17]||(s[17]=[t("p",null,"尚未开始冒险",-1)])]))])],2)])):A("",!0)])):(r(),o("div",Ue,[s[9]||(s[9]=t("div",{class:"selection-header"},[t("h1",null,"选择你的冒险"),t("p",null,"在不同的世界中展开独一无二的旅程")],-1)),t("div",qe,[(r(!0),o(X,null,Y(D.value,u=>(r(),o("div",{key:u.game_id,class:"game-card",onClick:S=>Ae(u.game_id)},[s[8]||(s[8]=t("div",{class:"game-card-icon"},"🎮",-1)),t("h3",null,p(u.name),1),t("p",null,p(u.description),1),t("div",Qe,[t("span",Xe,"v"+p(u.version),1),t("span",Ye,p(u.author),1)])],8,Fe))),128))])])),ee.value?(r(),o("div",Bs,[t("div",Es,[s[18]||(s[18]=t("div",{class:"dice-cup"},"🎲",-1)),t("div",Rs,[t("div",Is,p(((he=h.value)==null?void 0:he.description)||"天道裁决"),1),(ge=h.value)!=null&&ge.target?(r(),o("div",Ls,"目标值: ≤"+p(h.value.target),1)):A("",!0)]),((be=h.value)==null?void 0:be.result)!==void 0?(r(),o("div",Hs,[t("div",{class:Z(["roll-outcome",`outcome-${h.value.success?"成功":"失败"}`])},p(h.value.success?"成功":"失败"),3),t("div",Ps,p(h.value.result),1)])):A("",!0)])])):A("",!0),g.value?(r(),o("div",zs,[t("div",Js,[s[19]||(s[19]=t("div",{class:"spinner"},null,-1)),t("div",Ks,p(T.value),1)])])):A("",!0)])}}}),Ys=Je(Us,[["__scopeId","data-v-4f7d465c"]]);export{Ys as default};
