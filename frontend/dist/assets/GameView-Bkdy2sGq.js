import{d as ke,u as we,r as c,p as P,q as je,s as Se,c as d,h as N,m as n,F,v as Q,t as f,l as Ae,x as Oe,y as xe,z as Ve,A as le,n as p,e as Ge,B as S,o as u}from"./index-Bh8llI87.js";import{k as Te}from"./marked.esm-z4go5P_g.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const We={class:"game-container"},Me={key:0,class:"game-selection"},Be={class:"game-list"},Ne=["onClick"],Ee={class:"game-card-footer"},Le={class:"version"},Re={class:"author"},Ie={key:1,class:"game-play"},ze={class:"game-header"},He={class:"game-title"},Pe={class:"mod-id"},Je={class:"game-actions"},Ke={class:"opportunities"},Ue=["disabled"],qe={class:"game-content"},Fe={class:"status-panel"},Qe={class:"panel-content"},Xe={key:0,class:"character-status"},Ye={class:"status-key"},Ze=["innerHTML"],De={key:1,class:"no-character"},es={class:"game-main"},ss=["innerHTML"],ts={class:"input-area"},is=["disabled"],as={key:1,class:"action-input-row"},ns=["disabled"],ls=["disabled"],os={key:2,class:"success-message"},rs={key:2,class:"roll-overlay"},cs={class:"roll-panel"},ds={class:"roll-details"},us={class:"roll-type"},fs={key:0,class:"roll-target"},vs={key:0,class:"roll-result-display"},ps={class:"roll-value"},ys={key:3,class:"loading-overlay"},gs={class:"loading-spinner"},hs={class:"loading-text"},_s=ke({__name:"GameView",setup(ms){const X=Ge(),m=we(),J=c([]),h=c(""),Y=c(null),a=c(null),oe=P(()=>{var e;return((e=a.value)==null?void 0:e.display_history)||[]}),$=P(()=>{var e;return((e=a.value)==null?void 0:e.state)||a.value||{}}),Z=P(()=>{var t;const e=(t=$.value)==null?void 0:t.current_life;if(!e||typeof e!="object")return null;const s={};console.log("[filteredCurrentLife] å¤„ç†æ–°æ•°æ®ç»“æ„ï¼Œcurrent_life:",e);for(const[i,l]of Object.entries(e))if(l!=null&&l!==""&&l!==0){if(Array.isArray(l)&&l.length===0||typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;s[i]=l}return console.log("[filteredCurrentLife] è¿‡æ»¤åçš„æ•°æ®:",s),Object.keys(s).length>0?s:null}),A=c(""),E=P(()=>{var e;return((e=$.value)==null?void 0:e.is_processing)||!1}),b=c(!1),O=c("åŠ è½½ä¸­..."),K=c(!1),_=c(null),x=c(!1),L=c(!1);let r=null;const k=c(!1),V=c(!0),R=c();async function D(){try{b.value=!0;const e=await fetch("/api/game/mods",{headers:{Authorization:`Bearer ${m.token}`}});e.ok?J.value=await e.json():p.error("åŠ è½½æ¸¸æˆåˆ—è¡¨å¤±è´¥")}catch(e){console.error("åŠ è½½modåˆ—è¡¨å¤±è´¥:",e),p.error("ç½‘ç»œé”™è¯¯")}finally{b.value=!1}}async function re(e){V.value=!0,h.value=e,Y.value=J.value.find(s=>s.game_id===e),await ce()}async function ce(){try{b.value=!0,O.value="æ­£åœ¨åˆå§‹åŒ–æ¸¸æˆ...";const e=await fetch("/api/game/init",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m.token}`},body:JSON.stringify({mod_id:h.value})});if(e.ok){O.value="æ­£åœ¨åŠ è½½æ¸¸æˆæ•°æ®...";const s=await e.json();console.log("[GameView] åˆå§‹åŒ–å“åº”:",s),a.value=s.state||s,console.log("[GameView] gameStateè®¾ç½®ä¸º:",a.value),O.value="æ­£åœ¨å»ºç«‹å®æ—¶è¿æ¥...",ee()}else{const s=await e.text();console.error("[GameView] åˆå§‹åŒ–å¤±è´¥:",s),p.error("åˆå§‹åŒ–æ¸¸æˆå¤±è´¥: "+s)}}catch(e){console.error("åˆå§‹åŒ–æ¸¸æˆå¤±è´¥:",e),p.error("ç½‘ç»œé”™è¯¯")}finally{b.value=!1}}function ee(){const s=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/game/ws?mod_id=${h.value}&token=${m.token}`;console.log("[GameView] æ­£åœ¨è¿æ¥WebSocket:",s.replace(m.token||"","TOKEN")),r=new WebSocket(s),r.onopen=()=>{console.log("[GameView] âœ… WebSocketå·²è¿æ¥"),k.value=!0,b.value=!1,p.success("è¿æ¥æˆåŠŸ")},r.onmessage=t=>{console.log("[GameView] æ”¶åˆ°WebSocketæ¶ˆæ¯:",t.data);try{const i=JSON.parse(t.data);de(i)}catch(i){console.error("[GameView] è§£æWebSocketæ¶ˆæ¯å¤±è´¥:",i)}},r.onerror=t=>{console.error("[GameView] âŒ WebSocketé”™è¯¯:",t),k.value=!1,p.error("è¿æ¥é”™è¯¯")},r.onclose=t=>{console.log("[GameView] WebSocketå·²æ–­å¼€, code:",t.code,"reason:",t.reason),k.value=!1,V.value&&h.value&&m.token&&setTimeout(()=>{console.log("[GameView] å°è¯•é‡æ–°è¿æ¥WebSocket..."),ee()},3e3)}}const G=c(""),I=c(!1),w=c(null),T=c(""),z=c(!1);function de(e){var s;switch(b.value=!1,e.type){case"narrative_chunk":I.value||(I.value=!0,G.value="",a.value&&a.value.display_history&&(a.value.display_history=[...a.value.display_history,G.value])),G.value+=e.data.content;let t=G.value;const i=t.indexOf("```json");i>=0&&(t=t.substring(0,i).trim());const l=t.indexOf("```");l>=0&&(t=t.substring(0,l).trim());const o=t.match(/ã€åˆ¤å®šç»“æœï¼š(æˆåŠŸ|å¤±è´¥)ã€‘/);if(o&&!w.value){w.value=t,se(o[1]==="æˆåŠŸ");return}if(a.value&&a.value.display_history){const C=a.value.display_history.length-1;a.value.display_history=[...a.value.display_history.slice(0,C),t]}S(()=>j());break;case"full_state":I.value=!1,z.value=!1,x.value=!1;const v=((s=a.value)==null?void 0:s.display_history)||[];a.value={...e.data,display_history:v},G.value="",T.value="",w.value=null,S(()=>j());break;case"roll_event":x.value=!0,se(e.data.success,e.data);break;case"roll_result":a.value&&a.value.display_history&&(a.value.display_history=[...a.value.display_history,e.data.content],S(()=>j()));break;case"second_stage_narrative":z.value||(z.value=!0,T.value="",a.value&&a.value.display_history&&(a.value.display_history=[...a.value.display_history,T.value])),T.value+=e.data.content;let y=T.value;const W=y.indexOf("```json");W>=0&&(y=y.substring(0,W).trim());const M=y.indexOf("```");if(M>=0&&(y=y.substring(0,M).trim()),a.value&&a.value.display_history){const C=a.value.display_history.length-1;a.value.display_history=[...a.value.display_history.slice(0,C),y],S(()=>j())}break;case"error":I.value=!1,z.value=!1,G.value="",T.value="",w.value=null,p.error(e.detail||"å‘ç”Ÿé”™è¯¯");break}}function se(e,s){K.value=!0,s?_.value={type:s.type||"å¤©é“è£å†³",target:s.target,description:s.description||"åˆ¤å®šä¸­...",result:s.result,success:e,outcome:s.outcome}:_.value={description:"åˆ¤å®šä¸­...",success:e},setTimeout(()=>{_.value&&(_.value.description=(s==null?void 0:s.description)||(e?"åˆ¤å®šæˆåŠŸï¼":"åˆ¤å®šå¤±è´¥ï¼"))},1500),setTimeout(()=>{if(K.value=!1,_.value=null,w.value&&a.value){const t=a.value.display_history.length-1;a.value.display_history=[...a.value.display_history.slice(0,t),w.value],S(()=>j())}w.value=null},3e3)}async function ue(){if(console.log("[GameView] startTrial è¢«è°ƒç”¨ï¼Œå‘é€start_trialæ¶ˆæ¯"),!r||r.readyState!==WebSocket.OPEN){console.error("[GameView] WebSocketæœªè¿æ¥"),p.error("è¿æ¥æœªå°±ç»ªï¼Œè¯·ç¨å€™é‡è¯•");return}a.value&&a.value.state&&(a.value.state.is_processing=!0),a.value&&a.value.display_history&&(a.value.display_history=[...a.value.display_history,"> å¼€å§‹è¯•ç‚¼"],S(()=>j())),b.value=!0,O.value="æ­£åœ¨å¼€å¯è¯•ç‚¼...",r.send(JSON.stringify({action:"start_trial"}))}function te(){if(A.value.trim()&&r&&r.readyState===WebSocket.OPEN){const e=A.value.trim();a.value&&a.value.state&&(a.value.state.is_processing=!0),a.value&&a.value.display_history&&(a.value.display_history=[...a.value.display_history,`> ${e}`],S(()=>j())),r.send(JSON.stringify({action:e})),A.value=""}}async function U(){if(h.value){L.value=!0;try{const e=await fetch("/api/game/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m.token}`},body:JSON.stringify({mod_id:h.value})});if(e.ok)p.success("å­˜æ¡£æˆåŠŸ");else{const s=await e.text();console.error("[GameView] å­˜æ¡£å¤±è´¥:",s),p.error("å­˜æ¡£å¤±è´¥")}}catch(e){console.error("[GameView] å­˜æ¡£å¼‚å¸¸:",e),p.error("å­˜æ¡£å¼‚å¸¸")}finally{L.value=!1}}}function fe(){confirm(`âš ï¸ ç¡®å®šè¦é‡å¯æœºç¼˜å—ï¼Ÿ

è¿™å°†ä¼šï¼š
â€¢ æ¸…ç©ºæ‰€æœ‰å­˜æ¡£æ•°æ®
â€¢ é‡ç½®æœºç¼˜æ¬¡æ•°ä¸º10æ¬¡
â€¢ æ— æ³•æ¢å¤å·²åˆ é™¤çš„æ•°æ®

ç¡®è®¤ç»§ç»­ï¼Ÿ`)&&ve()}async function ve(){var e;try{b.value=!0,O.value="æ­£åœ¨é‡å¯æœºç¼˜...",console.log("[GameView] é‡å¯æœºç¼˜ - token:",m.token?"exists":"missing");const s=await fetch("/api/game/restart-opportunities",{method:"POST",headers:{Authorization:`Bearer ${m.token}`,"Content-Type":"application/json"}});if(s.ok){const t=await s.json();console.log("[GameView] é‡å¯æœºç¼˜æˆåŠŸ:",t),V.value=!1,r&&(r.close(),r=null),k.value=!1,h.value="",a.value=null,await D(),p.success(`æœºç¼˜å·²é‡å¯ï¼åˆ é™¤äº† ${t.deleted_saves} æ¡å­˜æ¡£`)}else{const t=await s.text();console.error("[GameView] é‡å¯æœºç¼˜å¤±è´¥ - çŠ¶æ€ç :",s.status),console.error("[GameView] é‡å¯æœºç¼˜å¤±è´¥ - å“åº”:",t),console.error("[GameView] é‡å¯æœºç¼˜å¤±è´¥ - tokené•¿åº¦:",((e=m.token)==null?void 0:e.length)||0),s.status===401?(p.error("è®¤è¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•"),m.logout(),X.push("/login")):p.error("é‡å¯æœºç¼˜å¤±è´¥: "+t)}}catch(s){console.error("é‡å¯æœºç¼˜å¤±è´¥:",s),p.error("ç½‘ç»œé”™è¯¯")}finally{b.value=!1}}async function pe(){V.value=!1,h.value&&await U(),r&&(r.close(),r=null),k.value=!1,h.value="",a.value=null}async function ye(){V.value=!1,h.value&&await U(),r&&(r.close(),r=null),m.logout(),X.push("/login")}function ge(e){try{let s=e.replace(/\\n/g,`
`);return s=he(s),Te.parse(s,{breaks:!0,gfm:!0})}catch{return e.replace(/\\n/g,"<br>").replace(/\n/g,"<br>")}}function he(e){const s=e.split(`
`),t=[];let i=!1,l=[];for(let o=0;o<s.length;o++){const v=s[o],y=/[\s]{4,}.*[â”‚â”¼â†‘â†“â†â†’â”€]|[\s]{4,}.*[â”œâ”¤â”¬â”´]|^\s*[â”‚â”¼â†‘â†“â†â†’â”€â”œâ”¤â”¬â”´]/.test(v)||/^\s*[â”‚â”¼â†‘â†“â†â†’â”€â”œâ”¤â”¬â”´].*[\s]{2,}/.test(v)||/^\s{8,}.*[â†‘â†“â†â†’]/.test(v)||v.includes("â”€â”€â”€")||v.includes("â”‚")||v.includes("â”¼");y&&!i?(i=!0,l=[v]):y&&i?l.push(v):(!y&&i&&(i=!1,t.push("\n```\n"+l.join(`
`)+"\n```\n"),l=[]),t.push(v))}return i&&l.length>0&&t.push("\n```\n"+l.join(`
`)+"\n```\n"),t.join(`
`)}function _e(e){return e.startsWith("> ")?"user-message":e.startsWith("ã€åˆ¤å®šç»“æœï¼š")?"roll-result-message":e.startsWith("ã€")?"system-message":"narrative-message"}function H(e){const s=[{pattern:/^(å§“å|åç§°|è§’è‰²)$/i,icon:"ğŸ§™â€â™‚ï¸"},{pattern:/^(ä¿®ä¸º|ç»éªŒ|exp)$/i,icon:"âš¡"},{pattern:/^(å¢ƒç•Œ|ç­‰çº§|level|é˜¶ä½)$/i,icon:"ğŸ”ï¸"},{pattern:/^(ç”Ÿå‘½|è¡€é‡|hp|health)$/i,icon:"â¤ï¸"},{pattern:/^(å¯¿å…ƒ|å¯¿å‘½|å¹´é¾„|age)$/i,icon:"â³"},{pattern:/^(çµçŸ³|é‡‘å¸|è´§å¸|money|gold)$/i,icon:"ğŸ’"},{pattern:/^(ä½ç½®|åœ°ç‚¹|location)$/i,icon:"ğŸ“"},{pattern:/^(å‡ºèº«|èƒŒæ™¯|origin)$/i,icon:"ğŸ¡"},{pattern:/^(å¤©èµ‹|æ‰èƒ½|talent)$/i,icon:"â­"},{pattern:/^(çµæ ¹|èµ„è´¨|æ ¹éª¨)$/i,icon:"ğŸŒ¿"},{pattern:/^(å±æ€§|çŠ¶æ€|stats)$/i,icon:"ğŸ“Š"},{pattern:/^(åŠŸæ³•|æŠ€èƒ½|skill)$/i,icon:"ğŸ“š"},{pattern:/^(ç‰©å“|é“å…·|èƒŒåŒ…|inventory)$/i,icon:"ğŸ’"},{pattern:/^(çŠ¶æ€|æ•ˆæœ|buff|debuff)$/i,icon:"ğŸ’«"},{pattern:/^(äº‹ä»¶|å†å²|æ•…äº‹|history)$/i,icon:"ğŸ“œ"},{pattern:/^(ç›®æ ‡|ä»»åŠ¡|quest)$/i,icon:"ğŸ¯"},{pattern:/^(å…³ç³»|äººé™…|ç¤¾äº¤)$/i,icon:"ğŸ‘¥"},{pattern:/^(è¯å›­|å†œåœº|ç§æ¤)$/i,icon:"ğŸŒ±"},{pattern:/^(æ‚Ÿæ€§|æ™ºåŠ›|intelligence)$/i,icon:"ğŸ§ "},{pattern:/^(æ°”è¿|è¿æ°”|luck)$/i,icon:"ğŸ€"},{pattern:/^(å£°æœ›|åæœ›|reputation)$/i,icon:"â­"}];for(const t of s)if(t.pattern.test(e))return`${t.icon} ${e}`;return`ğŸ“‹ ${e}`}function q(e){if(e==null)return'<span class="empty-value">æ— </span>';if(typeof e=="string")return e;if(typeof e=="number")return e.toString();if(Array.isArray(e))return e.length===0?'<span class="empty-value">æ— </span>':e.map(s=>typeof s=="string"?`<div class="array-item">â€¢ ${s}</div>`:typeof s=="object"&&s!==null?s.åç§°&&s.æ•°é‡?`<div class="item-entry">â€¢ ${s.åç§°} Ã— ${s.æ•°é‡}${s.è¯´æ˜?`<br><span class="item-desc">${s.è¯´æ˜}</span>`:""}</div>`:`<div class="array-item">â€¢ ${ae(s)}</div>`:`<div class="array-item">â€¢ ${s}</div>`).join("");if(typeof e=="object"){if(e.äººç”Ÿç›®æ ‡||e.ç«‹å³ç›®æ ‡||e.é˜¶æ®µç›®æ ‡){let s='<div class="goal-system-container">';return e.äººç”Ÿç›®æ ‡&&(s+='<div class="goal-section goal-life">',s+='<div class="goal-section-title">ğŸŒŸ äººç”Ÿç›®æ ‡</div>',s+='<div class="goal-section-content">',e.äººç”Ÿç›®æ ‡.æè¿°&&(s+=`<div class="goal-field"><span class="field-label">æè¿°ï¼š</span>${e.äººç”Ÿç›®æ ‡.æè¿°}</div>`),e.äººç”Ÿç›®æ ‡.æ ¸å¿ƒåŠ¨æœº&&(s+=`<div class="goal-field"><span class="field-label">æ ¸å¿ƒåŠ¨æœºï¼š</span>${e.äººç”Ÿç›®æ ‡.æ ¸å¿ƒåŠ¨æœº}</div>`),e.äººç”Ÿç›®æ ‡.æœ€ç»ˆæ„¿æ™¯&&(s+=`<div class="goal-field"><span class="field-label">æœ€ç»ˆæ„¿æ™¯ï¼š</span>${e.äººç”Ÿç›®æ ‡.æœ€ç»ˆæ„¿æ™¯}</div>`),e.äººç”Ÿç›®æ ‡.å®¿å‘½çº è‘›&&Array.isArray(e.äººç”Ÿç›®æ ‡.å®¿å‘½çº è‘›)&&e.äººç”Ÿç›®æ ‡.å®¿å‘½çº è‘›.length>0&&(s+=`<div class="goal-field"><span class="field-label">å®¿å‘½çº è‘›ï¼š</span><div class="field-list">${e.äººç”Ÿç›®æ ‡.å®¿å‘½çº è‘›.map(t=>`<div class="list-item">â€¢ ${t}</div>`).join("")}</div></div>`),s+="</div></div>"),e.ç«‹å³ç›®æ ‡&&(s+='<div class="goal-section goal-immediate">',s+='<div class="goal-section-title">âš¡ ç«‹å³ç›®æ ‡</div>',s+='<div class="goal-section-content">',e.ç«‹å³ç›®æ ‡.æè¿°&&(s+=`<div class="goal-field"><span class="field-label">æè¿°ï¼š</span>${e.ç«‹å³ç›®æ ‡.æè¿°}</div>`),e.ç«‹å³ç›®æ ‡.ç´§è¿«ç¨‹åº¦&&(s+=`<div class="goal-field"><span class="field-label">ç´§è¿«ç¨‹åº¦ï¼š</span><span class="urgency-badge urgency-${e.ç«‹å³ç›®æ ‡.ç´§è¿«ç¨‹åº¦}">${e.ç«‹å³ç›®æ ‡.ç´§è¿«ç¨‹åº¦}</span></div>`),e.ç«‹å³ç›®æ ‡.å®Œæˆæ¡ä»¶&&(s+=`<div class="goal-field"><span class="field-label">å®Œæˆæ¡ä»¶ï¼š</span>${e.ç«‹å³ç›®æ ‡.å®Œæˆæ¡ä»¶}</div>`),e.ç«‹å³ç›®æ ‡.å¥–åŠ±é¢„æœŸ&&(s+=`<div class="goal-field"><span class="field-label">å¥–åŠ±é¢„æœŸï¼š</span>${e.ç«‹å³ç›®æ ‡.å¥–åŠ±é¢„æœŸ}</div>`),s+="</div></div>"),e.é˜¶æ®µç›®æ ‡&&(s+='<div class="goal-section goal-stage">',s+='<div class="goal-section-title">ğŸ“ˆ é˜¶æ®µç›®æ ‡</div>',s+='<div class="goal-section-content">',e.é˜¶æ®µç›®æ ‡.æè¿°&&(s+=`<div class="goal-field"><span class="field-label">æè¿°ï¼š</span>${e.é˜¶æ®µç›®æ ‡.æè¿°}</div>`),e.é˜¶æ®µç›®æ ‡.å…³é”®èŠ‚ç‚¹&&Array.isArray(e.é˜¶æ®µç›®æ ‡.å…³é”®èŠ‚ç‚¹)&&e.é˜¶æ®µç›®æ ‡.å…³é”®èŠ‚ç‚¹.length>0&&(s+=`<div class="goal-field"><span class="field-label">å…³é”®èŠ‚ç‚¹ï¼š</span><div class="field-list">${e.é˜¶æ®µç›®æ ‡.å…³é”®èŠ‚ç‚¹.map(t=>`<div class="list-item">â€¢ ${t}</div>`).join("")}</div></div>`),e.é˜¶æ®µç›®æ ‡.éšœç¢åˆ†æ&&(s+=`<div class="goal-field"><span class="field-label">éšœç¢åˆ†æï¼š</span>${e.é˜¶æ®µç›®æ ‡.éšœç¢åˆ†æ}</div>`),e.é˜¶æ®µç›®æ ‡.è§£å†³è·¯å¾„&&(s+=`<div class="goal-field"><span class="field-label">è§£å†³è·¯å¾„ï¼š</span>${e.é˜¶æ®µç›®æ ‡.è§£å†³è·¯å¾„}</div>`),s+="</div></div>"),s+="</div>",s}return e.å§“å||e.å¢ƒç•Œ||e.ä¿®ä¸º||e.çµæ ¹?me(e):ie(e)}return String(e)}function me(e){let s='<div class="attributes-expanded">';const t=["å§“å","å‡ºèº«","çµæ ¹","å¢ƒç•Œ","å¯¿å…ƒ","ç”Ÿå‘½å€¼","ä¿®ä¸º","çµçŸ³","æ ¹éª¨","æ‚Ÿæ€§","æ°”è¿","åˆå§‹å¤©èµ‹","åŠŸæ³•","ç¥é€š","ç‰©å“","çŠ¶æ€æ•ˆæœ","å…³ç³»ç½‘","å£°æœ›","ç‰¹æ®Šæ ‡è®°","çµå…½","é“ä¾£","æ´åºœ","è¯å›­"];return t.forEach(i=>{e[i]!==void 0&&e[i]!==null&&e[i]!==""&&!(Array.isArray(e[i])&&e[i].length===0)&&!(typeof e[i]=="object"&&!Array.isArray(e[i])&&Object.keys(e[i]).length===0)&&(s+=`<div class="attr-sub-item">
        <div class="attr-sub-key">${H(i)}</div>
        <div class="attr-sub-value">${q(e[i])}</div>
      </div>`)}),Object.keys(e).forEach(i=>{!t.includes(i)&&e[i]!==void 0&&e[i]!==null&&e[i]!==""&&!(Array.isArray(e[i])&&e[i].length===0)&&!(typeof e[i]=="object"&&!Array.isArray(e[i])&&Object.keys(e[i]).length===0)&&(s+=`<div class="attr-sub-item">
        <div class="attr-sub-key">${H(i)}</div>
        <div class="attr-sub-value">${q(e[i])}</div>
      </div>`)}),s+="</div>",s}function ie(e,s=0){const t=Object.entries(e).filter(([l,o])=>!(o==null||o===""||Array.isArray(o)&&o.length===0||typeof o=="object"&&!Array.isArray(o)&&Object.keys(o).length===0));if(t.length===0)return'<span class="empty-value">æ— </span>';let i='<div class="object-expanded">';return t.forEach(([l,o])=>{i+='<div class="object-item">',i+=`<div class="object-key">${H(l)}</div>`,i+='<div class="object-value">',o==null?i+='<span class="empty-value">æ— </span>':typeof o=="string"||typeof o=="number"||typeof o=="boolean"?i+=String(o):Array.isArray(o)?i+=be(o,s+1):typeof o=="object"?i+=ie(o,s+1):i+=String(o),i+="</div>",i+="</div>"}),i+="</div>",i}function be(e,s=0){if(e.length===0)return'<span class="empty-value">æ— </span>';let t='<div class="array-container">';return e.forEach(i=>{t+='<div class="array-item-wrapper">',typeof i=="string"||typeof i=="number"||typeof i=="boolean"?t+=`<div class="array-item-simple">â€¢ ${i}</div>`:typeof i=="object"&&i!==null?(t+='<div class="array-item-object">',t+=ae(i),t+="</div>"):t+=`<div class="array-item-simple">â€¢ ${i}</div>`,t+="</div>"}),t+="</div>",t}function ae(e){const s=Object.entries(e);if(s.length===0)return'<span class="empty-value">æ— </span>';let t='<div class="inline-object">';return s.forEach(([i,l])=>{l==null||l===""||(t+='<div class="inline-item">',t+=`<span class="inline-key">${i}:</span> `,typeof l=="string"||typeof l=="number"||typeof l=="boolean"?t+=`<span class="inline-value">${l}</span>`:Array.isArray(l)?t+=`<span class="inline-value">[${l.length}é¡¹]</span>`:typeof l=="object"?t+='<span class="inline-value">{å¯¹è±¡}</span>':t+=`<span class="inline-value">${l}</span>`,t+="</div>")}),t+="</div>",t}function $e(){var s;if(!k.value)return"è¿æ¥ä¸­...";const e=((s=$.value)==null?void 0:s.opportunities_remaining)??10;return console.log("[GameView] getStartButtonText - opportunities_remaining:",e),e<=0?"æœºç¼˜å·²å°½":e===10?"å¼€å§‹ç¬¬ä¸€æ¬¡è¯•ç‚¼":"å¼€å¯ä¸‹ä¸€æ¬¡è¯•ç‚¼"}function j(){R.value&&(R.value.scrollTop=R.value.scrollHeight)}return je(()=>{D()}),Se(()=>{V.value=!1,r&&(r.close(),r=null),k.value=!1}),(e,s)=>{var t,i,l,o,v,y,W,M,C,ne;return u(),d("div",We,[h.value?(u(),d("div",Ie,[n("header",ze,[n("div",He,[n("h2",null,f((t=Y.value)==null?void 0:t.name),1),n("span",Pe,f(h.value),1)]),n("div",Je,[n("span",Ke,[s[3]||(s[3]=Ae(" å‰©ä½™æœºç¼˜: ",-1)),n("strong",null,f(((i=$.value)==null?void 0:i.opportunities_remaining)??10),1)]),n("button",{onClick:U,class:"btn-save",disabled:L.value},f(L.value?"å­˜æ¡£ä¸­...":"ğŸ’¾ æ‰‹åŠ¨å­˜æ¡£"),9,Ue),n("button",{onClick:fe,class:"btn-restart",title:"æ¸…ç©ºæ‰€æœ‰å­˜æ¡£ï¼Œé‡æ–°å¼€å§‹"}," ğŸ”„ é‡å¯æœºç¼˜ "),n("button",{onClick:pe,class:"btn-secondary"},"åˆ‡æ¢æ¸¸æˆ"),n("button",{onClick:ye,class:"btn-danger"},"é€€å‡º")])]),n("div",qe,[n("aside",Fe,[s[5]||(s[5]=n("div",{class:"panel-header"},[n("h3",null,"è§’è‰²çŠ¶æ€")],-1)),n("div",Qe,[Z.value?(u(),d("div",Xe,[(u(!0),d(F,null,Q(Z.value,(g,B)=>(u(),d("div",{key:B,class:"status-item"},[n("div",Ye,f(H(B)),1),n("div",{class:"status-value",innerHTML:q(g)},null,8,Ze)]))),128))])):(u(),d("div",De,[...s[4]||(s[4]=[n("p",null,"å°šæœªå¼€å§‹å†’é™©",-1)])]))])]),n("main",es,[n("div",{class:"narrative-window",ref_key:"narrativeWindow",ref:R},[(u(!0),d(F,null,Q(oe.value,(g,B)=>(u(),d("div",{key:B,class:le(["narrative-block",_e(g)]),innerHTML:ge(g)},null,10,ss))),128))],512),n("footer",ts,[!((l=$.value)!=null&&l.is_in_trial)&&!((o=$.value)!=null&&o.daily_success_achieved)?(u(),d("button",{key:0,onClick:ue,disabled:!k.value||E.value||x.value||(((v=$.value)==null?void 0:v.opportunities_remaining)??0)<=0,class:"btn-start"},f($e()),9,is)):(y=$.value)!=null&&y.is_in_trial?(u(),d("div",as,[Oe(n("input",{"onUpdate:modelValue":s[0]||(s[0]=g=>A.value=g),type:"text",placeholder:"æ±æ¬²ä½•ä¸º...",onKeydown:Ve(te,["enter"]),disabled:E.value||x.value,class:"action-input"},null,40,ns),[[xe,A.value]]),n("button",{onClick:te,disabled:E.value||x.value||!A.value.trim(),class:"btn-primary"},f(E.value?"å¤„ç†ä¸­...":x.value?"åˆ¤å®šä¸­...":"è¡ŒåŠ¨"),9,ls)])):(W=$.value)!=null&&W.daily_success_achieved?(u(),d("div",os,[...s[6]||(s[6]=[n("p",null,"ğŸ‰ ä»Šæ—¥åŠŸå¾·åœ†æ»¡ï¼æ˜æ—¥å†æ¥ã€‚",-1)])])):N("",!0)])])])])):(u(),d("div",Me,[s[2]||(s[2]=n("div",{class:"selection-header"},[n("h1",null,"é€‰æ‹©ä½ çš„å†’é™©"),n("p",null,"åœ¨ä¸åŒçš„ä¸–ç•Œä¸­å±•å¼€ç‹¬ä¸€æ— äºŒçš„æ—…ç¨‹")],-1)),n("div",Be,[(u(!0),d(F,null,Q(J.value,g=>(u(),d("div",{key:g.game_id,class:"game-card",onClick:B=>re(g.game_id)},[s[1]||(s[1]=n("div",{class:"game-card-icon"},"ğŸ®",-1)),n("h3",null,f(g.name),1),n("p",null,f(g.description),1),n("div",Ee,[n("span",Le,"v"+f(g.version),1),n("span",Re,f(g.author),1)])],8,Ne))),128))])])),K.value?(u(),d("div",rs,[n("div",cs,[s[7]||(s[7]=n("div",{class:"dice-cup"},"ğŸ²",-1)),n("div",ds,[n("div",us,f(((M=_.value)==null?void 0:M.description)||"å¤©é“è£å†³"),1),(C=_.value)!=null&&C.target?(u(),d("div",fs,"ç›®æ ‡å€¼: â‰¤"+f(_.value.target),1)):N("",!0)]),((ne=_.value)==null?void 0:ne.result)!==void 0?(u(),d("div",vs,[n("div",{class:le(["roll-outcome",`outcome-${_.value.success?"æˆåŠŸ":"å¤±è´¥"}`])},f(_.value.success?"æˆåŠŸ":"å¤±è´¥"),3),n("div",ps,f(_.value.result),1)])):N("",!0)])])):N("",!0),b.value?(u(),d("div",ys,[n("div",gs,[s[8]||(s[8]=n("div",{class:"spinner"},null,-1)),n("div",hs,f(O.value),1)])])):N("",!0)])}}}),ws=Ce(_s,[["__scopeId","data-v-a8520ca7"]]);export{ws as default};
